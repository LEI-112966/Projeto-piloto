<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/test/java/informacaofilme/pages/FilmExampleDemoPage.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/test/java/informacaofilme/pages/FilmExampleDemoPage.java" />
              <option name="originalContent" value="package informacaofilme.pages;&#10;import informacaofilme.Film;&#10;import com.codeborne.selenide.SelenideElement;&#10;import com.codeborne.selenide.ElementsCollection;&#10;import com.codeborne.selenide.Condition;&#10;import com.codeborne.selenide.Selenide;&#10;import org.openqa.selenium.By;&#10;import org.openqa.selenium.support.FindBy;&#10;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;/**&#10; * Page object for the film example demo page.&#10; * Assumes the grid has 4 columns in order: Title, Release Year, Director, IMDB Link.&#10; * Converted to use Selenide Page Factory (@FindBy + Selenide.page(this)).&#10; */&#10;public class FilmExampleDemoPage {&#10;    @FindBy(css = &quot;vaadin-grid&quot;)&#10;    private SelenideElement grid;&#10;&#10;    @FindBy(css = &quot;vaadin-grid-sorter[path='col5']&quot;)&#10;    private SelenideElement sorterTitle; // header sorter for Title&#10;&#10;    public FilmExampleDemoPage() {&#10;        // no-op: fields are initialized by Selenide.page(Class)&#10;    }&#10;&#10;    // small helper to avoid potential NPEs when checking emptiness&#10;    private boolean isNullOrEmpty(String s) {&#10;        return s == null || s.isEmpty();&#10;    }&#10;&#10;    /**&#10;     * Reads the visible grid cells and builds a list of Film objects.&#10;     * This implementation groups cell contents in batches of 4 (title, year, director, link).&#10;     */&#10;    public List&lt;Film&gt; getFilms() {&#10;        // ensure the grid is visible before interacting&#10;        grid.shouldBe(Condition.visible);&#10;        ElementsCollection cellElements = grid.$$(By.cssSelector(&quot;vaadin-grid-cell-content&quot;));&#10;&#10;        List&lt;Film&gt; films = new ArrayList&lt;&gt;();&#10;        int cols = 4;&#10;        // Defensive: if the header cells are present among cell elements, skip them by filtering anchors/text content heuristics.&#10;        List&lt;String&gt; texts = new ArrayList&lt;&gt;();&#10;        for (SelenideElement c : cellElements) {&#10;            String text = c.getText().trim();&#10;            SelenideElement link = null;&#10;            try {&#10;                link = c.$(&quot;a&quot;);&#10;            } catch (Exception ignored) {}&#10;            if (link != null &amp;&amp; link.exists() &amp;&amp; (text.isEmpty() || text.startsWith(&quot;Click&quot;))) {&#10;                texts.add(&quot;::LINK::&quot; + (link.getAttribute(&quot;href&quot;) != null ? link.getAttribute(&quot;href&quot;) : &quot;&quot;));&#10;            } else {&#10;                texts.add(text);&#10;            }&#10;        }&#10;&#10;        // Try to find first real data row start by locating a title-like entry&#10;        // If number of texts is not divisible by cols, attempt to drop header chunk at beginning.&#10;        int startIndex = 0;&#10;        if (texts.size() % cols != 0) {&#10;            // find first index where remaining count % cols == 0 and text looks like a title (non-empty)&#10;            for (int i = 0; i &lt; texts.size(); i++) {&#10;                if (!texts.get(i).isEmpty() &amp;&amp; (texts.size() - i) % cols == 0) {&#10;                    startIndex = i;&#10;                    break;&#10;                }&#10;            }&#10;        }&#10;&#10;        for (int i = startIndex; i + cols - 1 &lt; texts.size(); i += cols) {&#10;            String title = texts.get(i);&#10;            String year = texts.get(i + 1);&#10;            String director = texts.get(i + 2);&#10;            String linkToken = texts.get(i + 3);&#10;            String href = &quot;&quot;;&#10;            if (linkToken.startsWith(&quot;::LINK::&quot;)) {&#10;                href = linkToken.replaceFirst(&quot;::LINK::&quot;, &quot;&quot;);&#10;            } else {&#10;                // try to fetch anchor from that particular cell element directly&#10;                try {&#10;                    SelenideElement cellElement = cellElements.get(i + 3);&#10;                    SelenideElement a = cellElement.$(&quot;a&quot;);&#10;                    if (a.exists()) href = a.getAttribute(&quot;href&quot;);&#10;                } catch (Exception ignored) {}&#10;            }&#10;            if (isNullOrEmpty(title) &amp;&amp; isNullOrEmpty(year) &amp;&amp; isNullOrEmpty(director) &amp;&amp; isNullOrEmpty(href)) {&#10;                continue; // skip empty rows&#10;            }&#10;            films.add(new Film(title, year, director, href));&#10;        }&#10;        return films;&#10;    }&#10;&#10;    /**&#10;     * Clicks the IMDB link for the first film matching the title.&#10;     * Returns true if clicked, false if not found.&#10;     */&#10;    public boolean clickImdbLinkByTitle(String filmTitle) {&#10;        grid.shouldBe(Condition.visible);&#10;        List&lt;Film&gt; films = getFilms();&#10;        for (Film f : films) {&#10;            if (f.getTitle().equalsIgnoreCase(filmTitle)) {&#10;                if (f.getImdbUrl() != null &amp;&amp; !f.getImdbUrl().isEmpty()) {&#10;                    Selenide.open(f.getImdbUrl());&#10;                    return true;&#10;                } else {&#10;                    // fallback: try to click anchor inside grid cell that contains title&#10;                    ElementsCollection cellElements = grid.$$(By.cssSelector(&quot;vaadin-grid-cell-content&quot;));&#10;                    for (int i = 0; i + 3 &lt; cellElements.size(); i += 4) {&#10;                        if (cellElements.get(i).getText().trim().equalsIgnoreCase(filmTitle)) {&#10;                            try {&#10;                                SelenideElement linkCell = cellElements.get(i + 3);&#10;                                SelenideElement a = linkCell.$(&quot;a&quot;);&#10;                                a.shouldBe(Condition.visible).click();&#10;                                return true;&#10;                            } catch (Exception e) {&#10;                                return false;&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;        return false;&#10;    }&#10;&#10;    /**&#10;     * Sorts grid by Title by clicking the header sorter.&#10;     */&#10;    public void sortByTitle() {&#10;        try {&#10;            // capture a snapshot before clicking so we can wait for the grid to update&#10;            List&lt;String&gt; before = getFilms().stream().map(Film::getTitle).toList();&#10;            sorterTitle.shouldBe(Condition.visible).click();&#10;            // wait up to 5s for the grid order to change&#10;            long end = System.currentTimeMillis() + 5000;&#10;            while (System.currentTimeMillis() &lt; end) {&#10;                List&lt;String&gt; after = getFilms().stream().map(Film::getTitle).toList();&#10;                if (!after.equals(before)) {&#10;                    return;&#10;                }&#10;                // short pause before retrying&#10;                Selenide.sleep(200);&#10;            }&#10;        } catch (Exception e) {&#10;            // no-op if sorter not found or wait interrupted&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package informacaofilme.pages;&#10;import informacaofilme.Film;&#10;import com.codeborne.selenide.SelenideElement;&#10;import com.codeborne.selenide.ElementsCollection;&#10;import com.codeborne.selenide.Condition;&#10;import com.codeborne.selenide.Selenide;&#10;import org.openqa.selenium.By;&#10;import org.openqa.selenium.support.FindBy;&#10;&#10;import java.util.ArrayList;&#10;import java.util.List;&#10;&#10;/**&#10; * Page object for the film example demo page.&#10; * Assumes the grid has 4 columns in order: Title, Release Year, Director, IMDB Link.&#10; * Converted to use Selenide Page Factory (@FindBy + Selenide.page(this)).&#10; */&#10;public class FilmExampleDemoPage {&#10;    @FindBy(css = &quot;vaadin-grid&quot;)&#10;    private SelenideElement grid;&#10;&#10;    @FindBy(css = &quot;vaadin-grid-sorter[path='col5']&quot;)&#10;    private SelenideElement sorterTitle; // header sorter for Title&#10;&#10;    public FilmExampleDemoPage() {&#10;        // no-op: fields are initialized by Selenide.page(Class)&#10;    }&#10;&#10;    // small helper to avoid potential NPEs when checking emptiness&#10;    private boolean isNullOrEmpty(String s) {&#10;        return s == null || s.isEmpty();&#10;    }&#10;&#10;    /**&#10;     * Reads the visible grid cells and builds a list of Film objects.&#10;     * This implementation groups cell contents in batches of 4 (title, year, director, link).&#10;     */&#10;    public List&lt;Film&gt; getFilms() {&#10;        // ensure the grid is visible before interacting&#10;        grid.shouldBe(Condition.visible);&#10;        ElementsCollection cellElements = grid.$$(By.cssSelector(&quot;vaadin-grid-cell-content&quot;));&#10;&#10;        List&lt;Film&gt; films = new ArrayList&lt;&gt;();&#10;        int cols = 4;&#10;        // Defensive: if the header cells are present among cell elements, skip them by filtering anchors/text content heuristics.&#10;        List&lt;String&gt; texts = new ArrayList&lt;&gt;();&#10;        for (SelenideElement c : cellElements) {&#10;            String text = c.getText().trim();&#10;            SelenideElement link = null;&#10;            try {&#10;                link = c.$(&quot;a&quot;);&#10;            } catch (Exception ignored) {}&#10;            if (link != null &amp;&amp; link.exists() &amp;&amp; (text.isEmpty() || text.startsWith(&quot;Click&quot;))) {&#10;                texts.add(&quot;::LINK::&quot; + (link.getAttribute(&quot;href&quot;) != null ? link.getAttribute(&quot;href&quot;) : &quot;&quot;));&#10;            } else {&#10;                texts.add(text);&#10;            }&#10;        }&#10;&#10;        // Try to find first real data row start by locating a title-like entry&#10;        // If number of texts is not divisible by cols, attempt to drop header chunk at beginning.&#10;        int startIndex = 0;&#10;        if (texts.size() % cols != 0) {&#10;            // find first index where remaining count % cols == 0 and text looks like a title (non-empty)&#10;            for (int i = 0; i &lt; texts.size(); i++) {&#10;                if (!texts.get(i).isEmpty() &amp;&amp; (texts.size() - i) % cols == 0) {&#10;                    startIndex = i;&#10;                    break;&#10;                }&#10;            }&#10;        }&#10;&#10;        for (int i = startIndex; i + cols - 1 &lt; texts.size(); i += cols) {&#10;            String title = texts.get(i);&#10;            String year = texts.get(i + 1);&#10;            String director = texts.get(i + 2);&#10;            String linkToken = texts.get(i + 3);&#10;            String href = &quot;&quot;;&#10;            if (linkToken.startsWith(&quot;::LINK::&quot;)) {&#10;                href = linkToken.replaceFirst(&quot;::LINK::&quot;, &quot;&quot;);&#10;            } else {&#10;                // try to fetch anchor from that particular cell element directly&#10;                try {&#10;                    SelenideElement cellElement = cellElements.get(i + 3);&#10;                    SelenideElement a = cellElement.$(&quot;a&quot;);&#10;                    if (a.exists()) href = a.getAttribute(&quot;href&quot;);&#10;                } catch (Exception ignored) {}&#10;            }&#10;            if (isNullOrEmpty(title) &amp;&amp; isNullOrEmpty(year) &amp;&amp; isNullOrEmpty(director) &amp;&amp; isNullOrEmpty(href)) {&#10;                continue; // skip empty rows&#10;            }&#10;            films.add(new Film(title, year, director, href));&#10;        }&#10;        return films;&#10;    }&#10;&#10;    /**&#10;     * Clicks the IMDB link for the first film matching the title.&#10;     * Returns true if clicked, false if not found.&#10;     */&#10;    public boolean clickImdbLinkByTitle(String filmTitle) {&#10;        grid.shouldBe(Condition.visible);&#10;        List&lt;Film&gt; films = getFilms();&#10;        for (Film f : films) {&#10;            if (f.getTitle().equalsIgnoreCase(filmTitle)) {&#10;                if (f.getImdbUrl() != null &amp;&amp; !f.getImdbUrl().isEmpty()) {&#10;                    Selenide.open(f.getImdbUrl());&#10;                    return true;&#10;                } else {&#10;                    // fallback: try to click anchor inside grid cell that contains title&#10;                    ElementsCollection cellElements = grid.$$(By.cssSelector(&quot;vaadin-grid-cell-content&quot;));&#10;                    for (int i = 0; i + 3 &lt; cellElements.size(); i += 4) {&#10;                        if (cellElements.get(i).getText().trim().equalsIgnoreCase(filmTitle)) {&#10;                            try {&#10;                                SelenideElement linkCell = cellElements.get(i + 3);&#10;                                SelenideElement a = linkCell.$(&quot;a&quot;);&#10;                                a.shouldBe(Condition.visible).click();&#10;                                return true;&#10;                            } catch (Exception e) {&#10;                                return false;&#10;                            }&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;        }&#10;        return false;&#10;    }&#10;&#10;    /**&#10;     * Sorts grid by Title by clicking the header sorter.&#10;     */&#10;    public void sortByTitle() {&#10;        try {&#10;            // capture a snapshot before clicking so we can wait for the grid to update&#10;            List&lt;String&gt; before = getFilms().stream().map(Film::getTitle).toList();&#10;            sorterTitle.shouldBe(Condition.visible).click();&#10;            // wait up to 5s for the grid order to change&#10;            long end = System.currentTimeMillis() + 5000;&#10;            while (System.currentTimeMillis() &lt; end) {&#10;                List&lt;String&gt; after = getFilms().stream().map(Film::getTitle).toList();&#10;                if (!after.equals(before)) {&#10;                    return;&#10;                }&#10;                // short pause before retrying&#10;                Selenide.sleep(200);&#10;            }&#10;        } catch (Exception e) {&#10;            // no-op if sorter not found or wait interrupted&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>